import csv
import os

# Input and output file paths
input_csv_path = 'updated-4000-csv-for-excel.csv'
output_csv_path = 'vulnerabilities_detailed.csv'

# Open the input CSV file to read data and the output CSV file to write the reformatted data
try:
    with open(input_csv_path, mode='r', newline='', encoding='utf-8') as csvfile, \
            open(output_csv_path, mode='w', newline='', encoding='utf-8') as new_csvfile:

        reader = csv.DictReader(csvfile)
        fieldnames = ['Name', 'Downloads', 'Severity', 'Vulnerability']
        writer = csv.DictWriter(new_csvfile, fieldnames=fieldnames)
        writer.writeheader()

        # Iterate through each row in the input CSV
        for row in reader:
            extension_name = row['Name']
            downloads = row['Downloads']
            vulnerabilities = row['vulnerabilities'].split('; ')

            # For each vulnerability, write a new row to the output CSV
            for vulnerability in vulnerabilities:
                if vulnerability:  # Checking if there is a vulnerability to avoid empty rows
                    severity, _, vul_name = vulnerability.partition(': ')
                    writer.writerow({
                        'Name': extension_name,
                        'Downloads': downloads,
                        'Severity': severity,
                        'Vulnerability': vul_name.strip()
                    })

    print("Finished processing and creating the vulnerabilities detailed CSV.")

except Exception as e:
    print(f"An error occurred: {e}")
